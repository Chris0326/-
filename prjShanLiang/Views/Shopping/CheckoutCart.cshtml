@model List<prjShanLiang.Models.CShoppingCartItem>

@{
    ViewBag.Title = "確認訂單";
}
@section Styles{
    <style>
        .marg {
            margin: 15px 50px 0px 50px;
            width: 120px;
            height: 100px;
        }
        .btn {
            width: 100px;
        }

        li {
            font-size: 20px;
        }

        .divcard{
            margin: 30px 50px 30px 100px;
            font-size: 16px;
            text-align:center;            
        }

        .card {
            width: 500px;
            height: 600px;
            margin: 10px 0px 20px 20px;
            padding: 15px;
        }

        label {
            font-size: 20px;
        }
    </style>
}
@section Scripts{
    @*此方法可以取得總金額和備註並傳回後端 myBtn是按鈕*@
    <script>
        const myBtn = document.getElementById('myBtn')
        myBtn.addEventListener('click', () => {
            let remark = saveRemark();
            let sum = saveSum();
            window.location.replace('@Url.Content("~/Shopping/CreateOrder")?sum=' + sum + '&remark=' + remark)
        })
        function saveRemark() {
            const textarea = document.getElementById("txtremark");
            const remark = textarea.value;
            return remark
        }
        function saveSum() {
            const textarea = document.getElementById("txtsum");
            const sum = textarea.value;
            return sum
        }
    </script>
}

<main id="main">
    <div class="container aos-init aos-animate" data-aos="fade-up">
        <!-- ======= Breadcrumbs ======= -->
        <div class="breadcrumbs">
            <div class="container">

                <div class="d-flex justify-content-between align-items-center">
                    <h2>@ViewData["Title"]</h2>
                </div>               
            </div>
        </div><!-- End Breadcrumbs -->
        <form action="CreateOrder">
        <div class="col-15 col-md-10 col-lg-4 divcard">
            <div class="card shadow p-3 mb-5 bg-white rounded">
                <h2 class=text-center style="margin:20px; font-size:40px;">餐點內容</h2>

                <table class="table">
                    <tr>
                        <th>
                            餐點
                        </th>
                        <th>
                            數量
                        </th>
                        <th>
                            售價
                        </th>
                        <th>
                            小計
                        </th>
                    </tr>
                    @{
                        int pay = 0;
                        int tax = 0;
                        int sum = 0;

                        foreach (var item in Model)
                        {
                            pay += item.小計;
                            <tr>
                                <td>
                                    @Html.DisplayFor(modelItem => item.mealmenu.MealName)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.count)
                                </td>
                                <td>
                                    NT$ @Html.DisplayFor(modelItem => item.price)
                                </td>
                                <td>
                                    NT$ @Html.DisplayFor(modelItem => item.小計)
                                </td>
                            </tr>
                        }
                        tax = Convert.ToInt32(pay * 0.1M);
                        sum = pay + tax;
                    }
                </table>
                <br />                
                <div style="margin:20px;">
                    <input type="hidden" name="txtsum" id="txtsum" value="@sum" />
                    <li>餐點金額:NT$@pay.ToString("###,###,##0")</li>

                    <li>服  務  費:NT$@tax.ToString("###,###,##0")</li>

                    <li>應付金額:NT$@sum.ToString("###,###,##0")</li>

                </div>
                <div>
                    <p>
                        優惠碼 : <input type="text" name="coupon" value="" class="texbox" />
                        @Html.ActionLink("輸入", "CheckoutCart", "Shopping", new { /*id=item.mealmenu.MealId*/   }, new { @class = "btn btn-primary" })
                    </p>
                </div>
            </div>
        </div>
        
        <div class="col-15 col-md-10 col-lg-4 divcard ">
            <div class="card shadow p-3 mb-5 bg-white rounded">               
                <h2 class=text-center style="margin:20px; font-size:40px;">訂單資料</h2>
                <hr>
                <div class="card-body" >                   
                    <div style="display:flex;">
                        <div class="marg">
                            <label>訂購人姓名</label>
                            <label>@ViewBag.MemberName</label>
                        </div>
                        <div class="marg">
                            <label>訂購人電話</label>
                            <label>@ViewBag.MemberPhone</label>
                        </div>              
                    </div>
                    <hr />                    
                    <div style="display:flex;">
                        <div class="marg">
                            <label>訂單狀態</label>
                            <br>
                            <label>尚未付款</label>
                        </div>
                        <div class="marg">
                            <label>付款方式</label>
                            <br>
                            @Html.RadioButton("paymentMethod", "creditCard")
                            @Html.Label("paymentMethod", "信用卡")
                            <br>
                            @Html.RadioButton("paymentMethod", "cash")
                            @Html.Label("paymentMethod", "現金付款")
                        </div>
                    </div>
                    <hr />                          
                    <div>
                       <div>
                           <br>                            
                            <label>備註:  </label>
                                <textarea id="txtremark" name="txtremark" style="resize: none;"></textarea>
                            
                       </div>
                        <br>
                        <div style="text-align:center">
                                <input type="button" id="myBtn" value="前往付款" class="btn btn-danger" />
                                @*@Html.ActionLink("前往付款", "CreateOrder", "Shopping",  new{sum=sum } , new { @class = "btn btn-danger" ,onclick="saveRemark()"})*@
                            @Html.ActionLink("取消", "Menu", "Shopping", null, new { @class = "btn btn-danger " } )
                        </div>
                    </div>
                    </div>       
                </div>
            </div>
        </form>
    </div>
    </main><!-- End #main -->

